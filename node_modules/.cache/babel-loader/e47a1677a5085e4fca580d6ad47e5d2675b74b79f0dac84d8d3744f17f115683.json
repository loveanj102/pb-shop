{"ast":null,"code":"import{useEffect,useRef,useState}from'react';import axios from'axios';import CouponModal from'../../components/CouponModal';import DeleteModal from'../../components/DeleteModal';import Pagination from'../../components/Pagination';import{Modal}from'bootstrap';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function AdminCoupons(){const[coupons,setCoupons]=useState([]);// 空陣列\nconst[pagination,setPagination]=useState({});//物件內容\nconst couponModal=useRef(null);//使用useRef匯入Modal\nconst deleteModal=useRef(null);// Type:決定Modal展開的用途\n//此段程式碼為“編輯”商品資訊預設變數\nconst[type,setType]=useState('create');//當我點選type是'create'的時候，就表示我是要新增商品\nconst[tempCoupon,setTempCoupon]=useState({});//當我編輯資料，必須要帶入原本資料，需要有一個暫存欄位\nuseEffect(()=>{couponModal.current=new Modal('#productModal',{backdrop:'static'});//預設此Modal為一個新的Modal,並且backdrop click = false\ndeleteModal.current=new Modal('#deleteModal',{backdrop:'static'});getCoupons();},[]);const getCoupons=async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;//page=1 參數預設值，假設沒有帶入任何函數預設值就會等於1\nconst res=await axios.get(\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/coupons?page=\").concat(page));//4.遠端取得產品列表\nconsole.log(res);setCoupons(res.data.coupons);//取出產品相關資料，產品資料放置位置，看console.log\nsetPagination(res.data.pagination);//取出分頁相關資料\n};//以下程式碼為展開＆關閉Modal\nconst openCouponModal=(type,item)=>{setType(type);//寫入方法傳入type值\nsetTempCoupon(item);// 寫入方法傳入product值\ncouponModal.current.show();};const closeModal=()=>{couponModal.current.hide();};const openDeleteModal=product=>{//刪除Modal只需傳入產品資訊，不需要做狀態判斷\nsetTempCoupon(product);// 寫入方法傳入product值\ndeleteModal.current.show();};const closeDeleteModal=()=>{deleteModal.current.hide();};const deleteCoupon=async id=>{//使用async傳入id，將要刪除的產品從API刪除\ntry{const res=await axios.delete(\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/coupon/\").concat(id));if(res.data.success){getCoupons();deleteModal.current.hide();}}catch(error){console.log(error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-3\",children:[/*#__PURE__*/_jsx(CouponModal,{closeModal:closeModal,getCoupons:getCoupons,tempCoupon:tempCoupon,type:type}),/*#__PURE__*/_jsx(DeleteModal,{close:closeDeleteModal,text:tempCoupon.title,handleDelete:deleteCoupon,id:tempCoupon.id}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u512A\\u60E0\\u5238\\u5217\\u8868\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"text-end\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-sm\",onClick:()=>openCouponModal('create',{})//將openProductModal改為箭頭函示，為了要帶入判斷'create' , {}預設為一個空物件\n,children:\"\\u5EFA\\u7ACB\\u65B0\\u512A\\u60E0\\u5238\"})}),/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u6A19\\u984C\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u6298\\u6263\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u5230\\u671F\\u65E5\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u512A\\u60E0\\u78BC\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u555F\\u7528\\u72C0\\u614B\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u7DE8\\u8F2F\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:coupons.map(product=>{//找的時候用products複數意旨全部產品，取出帶入值使用product單筆取出\nreturn/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:product.title}),/*#__PURE__*/_jsx(\"td\",{children:product.percent}),/*#__PURE__*/_jsx(\"td\",{children:new Date(product.due_date).toDateString()}),/*#__PURE__*/_jsx(\"td\",{children:product.code}),/*#__PURE__*/_jsx(\"td\",{children:product.is_enabled?'啟用':'未啟用'}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-sm\",onClick:()=>openCouponModal('edit',product)//,後面帶入產品資訊\n,children:\"\\u7DE8\\u8F2F\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-outline-danger btn-sm ms-2\",onClick:()=>openDeleteModal(product),children:\"\\u522A\\u9664\"})]})]},product.id);})})]}),/*#__PURE__*/_jsx(Pagination,{pagination:pagination,changePage:getCoupons})]});}export default AdminCoupons;","map":{"version":3,"names":["useEffect","useRef","useState","axios","CouponModal","DeleteModal","Pagination","Modal","jsx","_jsx","jsxs","_jsxs","AdminCoupons","coupons","setCoupons","pagination","setPagination","couponModal","deleteModal","type","setType","tempCoupon","setTempCoupon","current","backdrop","getCoupons","page","arguments","length","undefined","res","get","concat","process","env","REACT_APP_API_PATH","console","log","data","openCouponModal","item","show","closeModal","hide","openDeleteModal","product","closeDeleteModal","deleteCoupon","id","delete","success","error","className","children","close","text","title","handleDelete","onClick","scope","map","percent","Date","due_date","toDateString","code","is_enabled","changePage"],"sources":["/Users/nikki.kang/Desktop/Nikki/website/pb-shop/src/pages/admin/AdminCoupons.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport axios from 'axios';\nimport CouponModal from '../../components/CouponModal'\nimport DeleteModal from '../../components/DeleteModal';\nimport Pagination from '../../components/Pagination';\nimport { Modal } from 'bootstrap';\n\nfunction AdminCoupons() {\n    const [coupons, setCoupons] = useState([]); // 空陣列\n    const [pagination, setPagination] = useState({}); //物件內容\n    const couponModal = useRef(null); //使用useRef匯入Modal\n    const deleteModal = useRef(null);\n\n    // Type:決定Modal展開的用途\n    //此段程式碼為“編輯”商品資訊預設變數\n    const [type, setType] = useState('create'); //當我點選type是'create'的時候，就表示我是要新增商品\n    const [tempCoupon, setTempCoupon] = useState({}); //當我編輯資料，必須要帶入原本資料，需要有一個暫存欄位\n\n\n    useEffect(() => {\n        couponModal.current = new Modal('#productModal', {\n            backdrop: 'static',\n        }); //預設此Modal為一個新的Modal,並且backdrop click = false\n        deleteModal.current = new Modal('#deleteModal', { backdrop: 'static', });\n        getCoupons();\n    }, []);\n\n    const getCoupons = async (page = 1) => { //page=1 參數預設值，假設沒有帶入任何函數預設值就會等於1\n        const res = await axios.get(`/v2/api/${process.env.REACT_APP_API_PATH}/admin/coupons?page=${page}`,\n        ); //4.遠端取得產品列表\n        console.log(res);\n        setCoupons(res.data.coupons); //取出產品相關資料，產品資料放置位置，看console.log\n        setPagination(res.data.pagination); //取出分頁相關資料\n    }\n    //以下程式碼為展開＆關閉Modal\n    const openCouponModal = (type, item) => {\n        setType(type); //寫入方法傳入type值\n        setTempCoupon(item); // 寫入方法傳入product值\n        couponModal.current.show();\n    }\n\n    const closeModal = () => {\n        couponModal.current.hide();\n    }\n\n    const openDeleteModal = (product) => { //刪除Modal只需傳入產品資訊，不需要做狀態判斷\n        setTempCoupon(product); // 寫入方法傳入product值\n        deleteModal.current.show();\n    };\n\n    const closeDeleteModal = () => {\n        deleteModal.current.hide();\n    };\n\n    const deleteCoupon = async (id) => { //使用async傳入id，將要刪除的產品從API刪除\n        try {\n            const res = await axios.delete(`/v2/api/${process.env.REACT_APP_API_PATH}/admin/coupon/${id}`);\n            if (res.data.success) {\n                getCoupons();\n                deleteModal.current.hide();\n            }\n        } catch (error) {\n            console.log(error);\n        }\n    }\n\n\n\n    return (\n        <div className=\"p-3\">\n            <CouponModal\n                closeModal={closeModal}\n                getCoupons={getCoupons}\n                tempCoupon={tempCoupon}\n                type={type} />{/*透過props的方法傳送給元件*/}\n            <DeleteModal\n                close={closeDeleteModal}\n                text={tempCoupon.title}\n                handleDelete={deleteCoupon}\n                id={tempCoupon.id} />{/*handleDelete可以被重複使用，所以不需要特別設定專屬名稱*/}{/*透過props的方法傳送給元件*/}\n            <h3>優惠券列表</h3>\n            <hr />\n            <div className=\"text-end\">\n                <button\n                    type=\"button\"\n                    className=\"btn btn-primary btn-sm\"\n                    onClick={() => openCouponModal('create', {})} //將openProductModal改為箭頭函示，為了要帶入判斷'create' , {}預設為一個空物件\n                >\n                    建立新優惠券\n                </button>\n            </div>\n            <table className=\"table\">\n                <thead>\n                    <tr>\n                        <th scope=\"col\">標題</th>\n                        <th scope=\"col\">折扣</th>\n                        <th scope=\"col\">到期日</th>\n                        <th scope=\"col\">優惠碼</th>\n                        <th scope=\"col\">啟用狀態</th>\n                        <th scope=\"col\">編輯</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {coupons.map((product) => { //找的時候用products複數意旨全部產品，取出帶入值使用product單筆取出\n                        return (\n                            <tr key={product.id}>\n                                <td>{product.title}</td>\n                                <td>{product.percent}</td>\n                                <td>{new Date(product.due_date).toDateString()}</td>\n                                <td>{product.code}</td>\n                                <td>{product.is_enabled ? '啟用' : '未啟用'}</td>\n                                <td>\n                                    <button\n                                        type=\"button\"\n                                        className=\"btn btn-primary btn-sm\"\n                                        onClick={() => openCouponModal('edit', product)}//,後面帶入產品資訊\n                                    >\n                                        編輯\n                                    </button>\n                                    <button\n                                        type=\"button\"\n                                        className=\"btn btn-outline-danger btn-sm ms-2\"\n                                        onClick={() => openDeleteModal(product)}\n\n                                    >\n                                        刪除\n                                    </button>\n                                </td>\n                            </tr>\n                        )\n                    })}\n\n                </tbody>\n            </table>\n\n            <Pagination pagination={pagination} changePage={getCoupons} />\n        </div>\n    )\n}\n\nexport default AdminCoupons;"],"mappings":"AAAA,OAASA,SAAS,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CACnD,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,WAAW,KAAM,8BAA8B,CACtD,MAAO,CAAAC,WAAW,KAAM,8BAA8B,CACtD,MAAO,CAAAC,UAAU,KAAM,6BAA6B,CACpD,OAASC,KAAK,KAAQ,WAAW,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAElC,QAAS,CAAAC,YAAYA,CAAA,CAAG,CACpB,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGZ,QAAQ,CAAC,EAAE,CAAC,CAAE;AAC5C,KAAM,CAACa,UAAU,CAAEC,aAAa,CAAC,CAAGd,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAE;AAClD,KAAM,CAAAe,WAAW,CAAGhB,MAAM,CAAC,IAAI,CAAC,CAAE;AAClC,KAAM,CAAAiB,WAAW,CAAGjB,MAAM,CAAC,IAAI,CAAC,CAEhC;AACA;AACA,KAAM,CAACkB,IAAI,CAAEC,OAAO,CAAC,CAAGlB,QAAQ,CAAC,QAAQ,CAAC,CAAE;AAC5C,KAAM,CAACmB,UAAU,CAAEC,aAAa,CAAC,CAAGpB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAE;AAGlDF,SAAS,CAAC,IAAM,CACZiB,WAAW,CAACM,OAAO,CAAG,GAAI,CAAAhB,KAAK,CAAC,eAAe,CAAE,CAC7CiB,QAAQ,CAAE,QACd,CAAC,CAAC,CAAE;AACJN,WAAW,CAACK,OAAO,CAAG,GAAI,CAAAhB,KAAK,CAAC,cAAc,CAAE,CAAEiB,QAAQ,CAAE,QAAU,CAAC,CAAC,CACxEC,UAAU,CAAC,CAAC,CAChB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAA,UAAU,CAAG,cAAAA,CAAA,CAAoB,IAAb,CAAAC,IAAI,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAO;AACrC,KAAM,CAAAG,GAAG,CAAG,KAAM,CAAA3B,KAAK,CAAC4B,GAAG,YAAAC,MAAA,CAAYC,OAAO,CAACC,GAAG,CAACC,kBAAkB,yBAAAH,MAAA,CAAuBN,IAAI,CAChG,CAAC,CAAE;AACHU,OAAO,CAACC,GAAG,CAACP,GAAG,CAAC,CAChBhB,UAAU,CAACgB,GAAG,CAACQ,IAAI,CAACzB,OAAO,CAAC,CAAE;AAC9BG,aAAa,CAACc,GAAG,CAACQ,IAAI,CAACvB,UAAU,CAAC,CAAE;AACxC,CAAC,CACD;AACA,KAAM,CAAAwB,eAAe,CAAGA,CAACpB,IAAI,CAAEqB,IAAI,GAAK,CACpCpB,OAAO,CAACD,IAAI,CAAC,CAAE;AACfG,aAAa,CAACkB,IAAI,CAAC,CAAE;AACrBvB,WAAW,CAACM,OAAO,CAACkB,IAAI,CAAC,CAAC,CAC9B,CAAC,CAED,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACrBzB,WAAW,CAACM,OAAO,CAACoB,IAAI,CAAC,CAAC,CAC9B,CAAC,CAED,KAAM,CAAAC,eAAe,CAAIC,OAAO,EAAK,CAAE;AACnCvB,aAAa,CAACuB,OAAO,CAAC,CAAE;AACxB3B,WAAW,CAACK,OAAO,CAACkB,IAAI,CAAC,CAAC,CAC9B,CAAC,CAED,KAAM,CAAAK,gBAAgB,CAAGA,CAAA,GAAM,CAC3B5B,WAAW,CAACK,OAAO,CAACoB,IAAI,CAAC,CAAC,CAC9B,CAAC,CAED,KAAM,CAAAI,YAAY,CAAG,KAAO,CAAAC,EAAE,EAAK,CAAE;AACjC,GAAI,CACA,KAAM,CAAAlB,GAAG,CAAG,KAAM,CAAA3B,KAAK,CAAC8C,MAAM,YAAAjB,MAAA,CAAYC,OAAO,CAACC,GAAG,CAACC,kBAAkB,mBAAAH,MAAA,CAAiBgB,EAAE,CAAE,CAAC,CAC9F,GAAIlB,GAAG,CAACQ,IAAI,CAACY,OAAO,CAAE,CAClBzB,UAAU,CAAC,CAAC,CACZP,WAAW,CAACK,OAAO,CAACoB,IAAI,CAAC,CAAC,CAC9B,CACJ,CAAE,MAAOQ,KAAK,CAAE,CACZf,OAAO,CAACC,GAAG,CAACc,KAAK,CAAC,CACtB,CACJ,CAAC,CAID,mBACIxC,KAAA,QAAKyC,SAAS,CAAC,KAAK,CAAAC,QAAA,eAChB5C,IAAA,CAACL,WAAW,EACRsC,UAAU,CAAEA,UAAW,CACvBjB,UAAU,CAAEA,UAAW,CACvBJ,UAAU,CAAEA,UAAW,CACvBF,IAAI,CAAEA,IAAK,CAAE,CAAC,cAClBV,IAAA,CAACJ,WAAW,EACRiD,KAAK,CAAER,gBAAiB,CACxBS,IAAI,CAAElC,UAAU,CAACmC,KAAM,CACvBC,YAAY,CAAEV,YAAa,CAC3BC,EAAE,CAAE3B,UAAU,CAAC2B,EAAG,CAAE,CAAC,cACzBvC,IAAA,OAAA4C,QAAA,CAAI,gCAAK,CAAI,CAAC,cACd5C,IAAA,QAAK,CAAC,cACNA,IAAA,QAAK2C,SAAS,CAAC,UAAU,CAAAC,QAAA,cACrB5C,IAAA,WACIU,IAAI,CAAC,QAAQ,CACbiC,SAAS,CAAC,wBAAwB,CAClCM,OAAO,CAAEA,CAAA,GAAMnB,eAAe,CAAC,QAAQ,CAAE,CAAC,CAAC,CAAG;AAAA,CAAAc,QAAA,CACjD,sCAED,CAAQ,CAAC,CACR,CAAC,cACN1C,KAAA,UAAOyC,SAAS,CAAC,OAAO,CAAAC,QAAA,eACpB5C,IAAA,UAAA4C,QAAA,cACI1C,KAAA,OAAA0C,QAAA,eACI5C,IAAA,OAAIkD,KAAK,CAAC,KAAK,CAAAN,QAAA,CAAC,cAAE,CAAI,CAAC,cACvB5C,IAAA,OAAIkD,KAAK,CAAC,KAAK,CAAAN,QAAA,CAAC,cAAE,CAAI,CAAC,cACvB5C,IAAA,OAAIkD,KAAK,CAAC,KAAK,CAAAN,QAAA,CAAC,oBAAG,CAAI,CAAC,cACxB5C,IAAA,OAAIkD,KAAK,CAAC,KAAK,CAAAN,QAAA,CAAC,oBAAG,CAAI,CAAC,cACxB5C,IAAA,OAAIkD,KAAK,CAAC,KAAK,CAAAN,QAAA,CAAC,0BAAI,CAAI,CAAC,cACzB5C,IAAA,OAAIkD,KAAK,CAAC,KAAK,CAAAN,QAAA,CAAC,cAAE,CAAI,CAAC,EACvB,CAAC,CACF,CAAC,cACR5C,IAAA,UAAA4C,QAAA,CACKxC,OAAO,CAAC+C,GAAG,CAAEf,OAAO,EAAK,CAAE;AACxB,mBACIlC,KAAA,OAAA0C,QAAA,eACI5C,IAAA,OAAA4C,QAAA,CAAKR,OAAO,CAACW,KAAK,CAAK,CAAC,cACxB/C,IAAA,OAAA4C,QAAA,CAAKR,OAAO,CAACgB,OAAO,CAAK,CAAC,cAC1BpD,IAAA,OAAA4C,QAAA,CAAK,GAAI,CAAAS,IAAI,CAACjB,OAAO,CAACkB,QAAQ,CAAC,CAACC,YAAY,CAAC,CAAC,CAAK,CAAC,cACpDvD,IAAA,OAAA4C,QAAA,CAAKR,OAAO,CAACoB,IAAI,CAAK,CAAC,cACvBxD,IAAA,OAAA4C,QAAA,CAAKR,OAAO,CAACqB,UAAU,CAAG,IAAI,CAAG,KAAK,CAAK,CAAC,cAC5CvD,KAAA,OAAA0C,QAAA,eACI5C,IAAA,WACIU,IAAI,CAAC,QAAQ,CACbiC,SAAS,CAAC,wBAAwB,CAClCM,OAAO,CAAEA,CAAA,GAAMnB,eAAe,CAAC,MAAM,CAAEM,OAAO,CAAE;AAAA,CAAAQ,QAAA,CACnD,cAED,CAAQ,CAAC,cACT5C,IAAA,WACIU,IAAI,CAAC,QAAQ,CACbiC,SAAS,CAAC,oCAAoC,CAC9CM,OAAO,CAAEA,CAAA,GAAMd,eAAe,CAACC,OAAO,CAAE,CAAAQ,QAAA,CAE3C,cAED,CAAQ,CAAC,EACT,CAAC,GAtBAR,OAAO,CAACG,EAuBb,CAAC,CAEb,CAAC,CAAC,CAEC,CAAC,EACL,CAAC,cAERvC,IAAA,CAACH,UAAU,EAACS,UAAU,CAAEA,UAAW,CAACoD,UAAU,CAAE1C,UAAW,CAAE,CAAC,EAC7D,CAAC,CAEd,CAEA,cAAe,CAAAb,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}