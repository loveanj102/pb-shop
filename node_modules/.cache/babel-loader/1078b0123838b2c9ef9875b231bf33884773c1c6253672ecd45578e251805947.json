{"ast":null,"code":"import{useEffect,useRef,useState}from'react';import axios from'axios';import ProductModal from'../../components/ProductModal';import DeleteModal from'../../components/DeleteModal';import Pagination from'../../components/Pagination';import{Modal}from'bootstrap';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function AdminProducts(){const[products,setProducts]=useState([]);// 空陣列\nconst[pagination,setPagination]=useState({});//物件內容\nconst productModal=useRef(null);//使用useRef匯入Modal\nconst deleteModal=useRef(null);// Type:決定Modal展開的用途\n//此段程式碼為“編輯”商品資訊預設變數\nconst[type,setType]=useState('create');//當我點選type是'create'的時候，就表示我是要新增商品\nconst[tempProduct,setTempProduct]=useState({});//當我編輯資料，必須要帶入原本資料，需要有一個暫存欄位\nuseEffect(()=>{productModal.current=new Modal('#productModal',{backdrop:'static'});//預設此Modal為一個新的Modal,並且backdrop click = false\ndeleteModal.current=new Modal('#deleteModal',{backdrop:'static'});getProducts();},[]);const getProducts=async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;//page=1 參數預設值，假設沒有帶入任何函數預設值就會等於1\nconst productRes=await axios.get(\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/products?page=\").concat(page));//4.遠端取得產品列表\nconsole.log(productRes);setProducts(productRes.data.products);//取出產品相關資料，產品資料放置位置，看console.log\nsetPagination(productRes.data.pagination);//取出分頁相關資料\n};//以下程式碼為展開＆關閉Modal\nconst openProductModal=(type,product)=>{setType(type);//寫入方法傳入type值\nsetTempProduct(product);// 寫入方法傳入product值\nproductModal.current.show();};const closeProductModal=()=>{productModal.current.hide();};const openDeleteModal=product=>{//刪除Modal只需傳入產品資訊，不需要做狀態判斷\nsetTempProduct(product);// 寫入方法傳入product值\ndeleteModal.current.show();};const closeDeleteModal=()=>{deleteModal.current.hide();};const deleteProduct=async id=>{//使用async傳入id，將要刪除的產品從API刪除\ntry{const res=await axios.delete(\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/product/\").concat(id));if(res.data.success){//判斷如果api回傳資料為success就重新整理頁面\ngetProducts();deleteModal.current.hide();}}catch(error){console.log(error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-3\",children:[/*#__PURE__*/_jsx(ProductModal,{closeProductModal:closeProductModal,getProducts:getProducts,tempProduct:tempProduct,type:type}),\" \",/*#__PURE__*/_jsx(DeleteModal,{close:closeDeleteModal,text:tempProduct.title,handleDelete:deleteProduct,id:tempProduct.id}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u7522\\u54C1\\u5217\\u8868\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"text-end\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-sm\",onClick:()=>openProductModal('create',{})//將openProductModal改為箭頭函示，為了要帶入判斷'create' , {}預設為一個空物件\n,children:\"\\u5EFA\\u7ACB\\u65B0\\u5546\\u54C1\"})}),/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u5206\\u985E\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u540D\\u7A31\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u552E\\u50F9\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u555F\\u7528\\u72C0\\u614B\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u7DE8\\u8F2F\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:products.map(product=>{//找的時候用products複數意旨全部產品，取出帶入值使用product單筆取出\nreturn/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:product.category}),/*#__PURE__*/_jsx(\"td\",{children:product.title}),/*#__PURE__*/_jsx(\"td\",{children:product.price}),/*#__PURE__*/_jsx(\"td\",{children:product.is_enabled?'啟用':'未啟用'}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-sm\",onClick:()=>openProductModal('edit',product)//,後面帶入產品資訊\n,children:\"\\u7DE8\\u8F2F\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-outline-danger btn-sm ms-2\",onClick:()=>openDeleteModal(product),children:\"\\u522A\\u9664\"})]})]},product.id);})})]}),/*#__PURE__*/_jsx(Pagination,{pagination:pagination,changePage:getProducts})]});}export default AdminProducts;","map":{"version":3,"names":["useEffect","useRef","useState","axios","ProductModal","DeleteModal","Pagination","Modal","jsx","_jsx","jsxs","_jsxs","AdminProducts","products","setProducts","pagination","setPagination","productModal","deleteModal","type","setType","tempProduct","setTempProduct","current","backdrop","getProducts","page","arguments","length","undefined","productRes","get","concat","process","env","REACT_APP_API_PATH","console","log","data","openProductModal","product","show","closeProductModal","hide","openDeleteModal","closeDeleteModal","deleteProduct","id","res","delete","success","error","className","children","close","text","title","handleDelete","onClick","scope","map","category","price","is_enabled","changePage"],"sources":["/Users/nikki.kang/Desktop/Nikki/website/pb-shop/src/pages/admin/AdminProducts.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport axios from 'axios';\nimport ProductModal from '../../components/ProductModal'\nimport DeleteModal from '../../components/DeleteModal';\nimport Pagination from '../../components/Pagination';\nimport { Modal } from 'bootstrap';\n\nfunction AdminProducts() {\n    const [products, setProducts] = useState([]); // 空陣列\n    const [pagination, setPagination] = useState({}); //物件內容\n    const productModal = useRef(null); //使用useRef匯入Modal\n    const deleteModal = useRef(null);\n\n    // Type:決定Modal展開的用途\n    //此段程式碼為“編輯”商品資訊預設變數\n    const [type, setType] = useState('create'); //當我點選type是'create'的時候，就表示我是要新增商品\n    const [tempProduct, setTempProduct] = useState({}); //當我編輯資料，必須要帶入原本資料，需要有一個暫存欄位\n\n\n    useEffect(() => {\n        productModal.current = new Modal('#productModal', { backdrop: 'static', }); //預設此Modal為一個新的Modal,並且backdrop click = false\n        deleteModal.current = new Modal('#deleteModal', { backdrop: 'static', });\n        getProducts();\n    }, []);\n\n    const getProducts = async (page = 1) => { //page=1 參數預設值，假設沒有帶入任何函數預設值就會等於1\n        const productRes = await axios.get(`/v2/api/${process.env.REACT_APP_API_PATH}/admin/products?page=${page}`); //4.遠端取得產品列表\n        console.log(productRes);\n        setProducts(productRes.data.products); //取出產品相關資料，產品資料放置位置，看console.log\n        setPagination(productRes.data.pagination); //取出分頁相關資料\n    }\n    //以下程式碼為展開＆關閉Modal\n    const openProductModal = (type, product) => {\n        setType(type); //寫入方法傳入type值\n        setTempProduct(product); // 寫入方法傳入product值\n        productModal.current.show();\n    }\n\n    const closeProductModal = () => {\n        productModal.current.hide();\n    }\n\n    const openDeleteModal = (product) => { //刪除Modal只需傳入產品資訊，不需要做狀態判斷\n        setTempProduct(product); // 寫入方法傳入product值\n        deleteModal.current.show();\n    }\n\n    const closeDeleteModal = () => {\n        deleteModal.current.hide();\n    };\n\n    const deleteProduct = async (id) => { //使用async傳入id，將要刪除的產品從API刪除\n        try {\n            const res = await axios.delete(`/v2/api/${process.env.REACT_APP_API_PATH}/admin/product/${id}`)\n            if (res.data.success) { //判斷如果api回傳資料為success就重新整理頁面\n                getProducts();\n                deleteModal.current.hide();\n            }\n        } catch (error) {\n            console.log(error);\n        }\n    }\n\n\n\n    return (\n        <div className=\"p-3\">\n            <ProductModal\n                closeProductModal={closeProductModal}\n                getProducts={getProducts}\n                tempProduct={tempProduct}\n                type={type} /> {/*透過props的方法傳送給元件*/}\n            <DeleteModal\n                close={closeDeleteModal}\n                text={tempProduct.title}\n                handleDelete={deleteProduct}\n                id={tempProduct.id} />{/*handleDelete可以被重複使用，所以不需要特別設定專屬名稱*/}{/*透過props的方法傳送給元件*/}\n            <h3>產品列表</h3>\n            <hr />\n            <div className=\"text-end\">\n                <button\n                    type=\"button\"\n                    className=\"btn btn-primary btn-sm\"\n                    onClick={() => openProductModal('create', {})} //將openProductModal改為箭頭函示，為了要帶入判斷'create' , {}預設為一個空物件\n                >\n                    建立新商品\n                </button>\n            </div>\n            <table className=\"table\">\n                <thead>\n                    <tr>\n                        <th scope=\"col\">分類</th>\n                        <th scope=\"col\">名稱</th>\n                        <th scope=\"col\">售價</th>\n                        <th scope=\"col\">啟用狀態</th>\n                        <th scope=\"col\">編輯</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {products.map((product) => { //找的時候用products複數意旨全部產品，取出帶入值使用product單筆取出\n                        return (\n                            <tr key={product.id}>\n                                <td>{product.category}</td>\n                                <td>{product.title}</td>\n                                <td>{product.price}</td>\n                                <td>{product.is_enabled ? '啟用' : '未啟用'}</td>\n                                <td>\n                                    <button\n                                        type=\"button\"\n                                        className=\"btn btn-primary btn-sm\"\n                                        onClick={() => openProductModal('edit', product)}//,後面帶入產品資訊\n                                    >\n                                        編輯\n                                    </button>\n                                    <button\n                                        type=\"button\"\n                                        className=\"btn btn-outline-danger btn-sm ms-2\"\n                                        onClick={() => openDeleteModal(product)}\n\n                                    >\n                                        刪除\n                                    </button>\n                                </td>\n                            </tr>\n                        )\n                    })}\n\n                </tbody>\n            </table>\n\n            <Pagination pagination={pagination} changePage={getProducts} />\n        </div>\n    )\n}\n\nexport default AdminProducts;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}