{"ast":null,"code":"import{Outlet,useNavigate,Link}from'react-router-dom';import axios from'axios';import{useEffect,useReducer}from'react';import Message from'../../components/Message';import{MessageContext,messageReducer,initState}from'../../store/MessageStore';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Dashboard(){var _document$cookie$spli;const navigate=useNavigate();const reducer=useReducer(messageReducer,initState);const logout=()=>{//路由保護，按下登出按鈕清除cookie，事件建立\ndocument.cookie='shopToken=;';navigate(\"/login\");//網址轉回login page\n};//取出cookie token值 , 並取得產品列表\nconst token=(_document$cookie$spli=document.cookie.split(\"; \").find(row=>row.startsWith(\"shopToken=\")))===null||_document$cookie$spli===void 0?void 0:_document$cookie$spli.split(\"=\")[1];console.log(token);axios.defaults.headers.common['Authorization']=token;//4.登入時將token帶入\nuseEffect(()=>{if(!token){//如果用戶沒有攜帶token將強制回到login頁面\nnavigate(\"/login\");}(async()=>{//如果用戶有攜帶token就去驗證token是否正確\ntry{await axios.post(\"/v2/api/user/check\");//判斷用戶是否登入的方法\n}catch(error){console.log(error);if(!error.response.data.success){navigate(\"/login\");}}})();},[navigate,token]);return/*#__PURE__*/_jsxs(MessageContext.Provider,{value:reducer,children:[/*#__PURE__*/_jsx(Message,{}),/*#__PURE__*/_jsx(\"nav\",{className:\"navbar navbar-expand-lg bg-dark\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container-fluid\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-white mb-0\",children:\"D\\xE9part\\u5F8C\\u53F0\\u7BA1\\u7406\\u7CFB\\u7D71\"}),/*#__PURE__*/_jsx(\"button\",{className:\"navbar-toggler\",type:\"button\",\"data-bs-toggle\":\"collapse\",\"data-bs-target\":\"#navbarNav\",\"aria-controls\":\"navbarNav\",\"aria-expanded\":\"false\",\"aria-label\":\"Toggle navigation\",children:/*#__PURE__*/_jsx(\"span\",{className:\"navbar-toggler-icon\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"collapse navbar-collapse justify-content-end\",id:\"navbarNav\",children:/*#__PURE__*/_jsx(\"ul\",{className:\"navbar-nav\",children:/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-sm btn-light\",onClick:logout,children:\"\\u767B\\u51FA\"})})})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",style:{minHeight:'calc(100vh - 56px)'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-light\",style:{width:'200px'},children:/*#__PURE__*/_jsxs(\"ul\",{className:\"list-group list-group-flush\",children:[/*#__PURE__*/_jsxs(Link,{className:\"list-group-item list-group-item-action py-3\",to:\"/admin/products\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-cup-fill me-2\"}),\"\\u7522\\u54C1\\u5217\\u8868\"]}),/*#__PURE__*/_jsxs(Link,{className:\"list-group-item list-group-item-action py-3\",to:\"/admin/coupons\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-ticket-perforated-fill me-2\"}),\"\\u512A\\u60E0\\u5377\\u5217\\u8868\"]}),/*#__PURE__*/_jsxs(Link,{className:\"list-group-item list-group-item-action py-3\",to:\"/admin/orders\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-receipt me-2\"}),\"\\u8A02\\u55AE\\u5217\\u8868\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-100\",children:[token&&/*#__PURE__*/_jsx(Outlet,{}),\" \"]})]})]});}export default Dashboard;","map":{"version":3,"names":["Outlet","useNavigate","Link","axios","useEffect","useReducer","Message","MessageContext","messageReducer","initState","jsx","_jsx","jsxs","_jsxs","Dashboard","_document$cookie$spli","navigate","reducer","logout","document","cookie","token","split","find","row","startsWith","console","log","defaults","headers","common","post","error","response","data","success","Provider","value","children","className","type","id","onClick","style","minHeight","width","to"],"sources":["/Users/nikki.kang/Desktop/Nikki/website/pb-shop/src/pages/admin/Dashboard.js"],"sourcesContent":["import { Outlet, useNavigate, Link } from 'react-router-dom';\nimport axios from 'axios';\nimport { useEffect, useReducer } from 'react';\nimport Message from '../../components/Message';\nimport { MessageContext, messageReducer, initState } from '../../store/MessageStore';\n\n\nfunction Dashboard() {\n\n    const navigate = useNavigate();\n    const reducer = useReducer(messageReducer, initState);\n    const logout = () => { //路由保護，按下登出按鈕清除cookie，事件建立\n        document.cookie = 'shopToken=;'\n        navigate(`/login`) //網址轉回login page\n    }\n\n    //取出cookie token值 , 並取得產品列表\n    const token = document.cookie\n        .split(\"; \")\n        .find((row) => row.startsWith(\"shopToken=\"))\n        ?.split(\"=\")[1];\n    console.log(token);\n    axios.defaults.headers.common['Authorization'] = token; //4.登入時將token帶入\n\n\n    useEffect(() => {\n        if (!token) { //如果用戶沒有攜帶token將強制回到login頁面\n            navigate(`/login`);\n        }\n        (async () => { //如果用戶有攜帶token就去驗證token是否正確\n            try {\n                await axios.post(`/v2/api/user/check`); //判斷用戶是否登入的方法\n            } catch (error) {\n                console.log(error);\n                if (!error.response.data.success) {\n                    navigate(`/login`);\n                }\n            }\n        })();\n    }, [navigate, token]);\n\n\n    return (\n        <MessageContext.Provider value={reducer}>\n            <Message />\n            <nav className=\"navbar navbar-expand-lg bg-dark\">\n                <div className=\"container-fluid\">\n                    <p className=\"text-white mb-0\">\n                        Départ後台管理系統\n                    </p>\n                    <button\n                        className=\"navbar-toggler\"\n                        type=\"button\"\n                        data-bs-toggle=\"collapse\"\n                        data-bs-target=\"#navbarNav\"\n                        aria-controls=\"navbarNav\"\n                        aria-expanded=\"false\"\n                        aria-label=\"Toggle navigation\"\n                    >\n                        <span className=\"navbar-toggler-icon\" />\n                    </button>\n                    <div className=\"collapse navbar-collapse justify-content-end\" id=\"navbarNav\">\n                        <ul className=\"navbar-nav\">\n                            <li className=\"nav-item\">\n                                <button type=\"button\" className=\"btn btn-sm btn-light\" onClick={logout}>\n                                    登出\n                                </button>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </nav>\n            <div className=\"d-flex\" style={{ minHeight: 'calc(100vh - 56px)' }}>\n                <div className=\"bg-light\" style={{ width: '200px' }}>\n                    <ul className=\"list-group list-group-flush\">\n                        <Link className=\"list-group-item list-group-item-action py-3\" to=\"/admin/products\">\n                            <i className=\"bi bi-cup-fill me-2\" />\n                            產品列表\n                        </Link>\n                        <Link className=\"list-group-item list-group-item-action py-3\" to=\"/admin/coupons\">\n                            <i className=\"bi bi-ticket-perforated-fill me-2\" />\n                            優惠卷列表\n                        </Link>\n                        <Link className=\"list-group-item list-group-item-action py-3\" to=\"/admin/orders\">\n                            <i className=\"bi bi-receipt me-2\" />\n                            訂單列表\n                        </Link>\n                    </ul>\n                </div>\n                <div className=\"w-100\">\n                    {/* Products */}\n                    {token && <Outlet />} {/*token判斷是否夾帶 */}\n                    {/* Products end */}\n                </div>\n            </div>\n        </MessageContext.Provider>\n    )\n}\n\nexport default Dashboard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}